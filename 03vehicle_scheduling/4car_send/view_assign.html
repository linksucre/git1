<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<link href="../../images/logo.png" rel="shortcut icon" />
		<link rel="import" href="../../public.html">
			<script type="text/javascript" src="../../js/loading.js"></script>
     <style type="text/css">
     	body,html{
     		width: 100%;
     		height: 100%;
     	}
     	.car_name,.car_person{
     		color: dodgerblue;
     	}
     </style>
	<body class="easyui-layout">
		<div class="easyui-layout" data-options="fit:true" id="child_layout" style="width: 100%;height: 100%;;overflow: hidden;">
			<div data-options="region:'center',border:false" style="overflow: hidden;">
				<div id="p3" class="easyui-panel" title="任务相关信息" style="width:100%;border:none;overflow: hidden;" data-options="collapsible:true">
					 <table style="width:98%;margin: 20px; 0">
						<tbody>
							<tr>
								<td align="right" style="width: 100px">任务名称：</td>
								<td><label>生产用车</label></td>
								<td align="right">路线规划</td>
							</tr>
							<tr>
								<td align="right" style="width: 100px">用车时间：</td>
								<td style="width: 350px"><label id="useDate">2017-08-02 14:31</label></td>
								<td align="right" style="width: 100px">回车时间：</td>
								<td><label id="backDate">2017-08-03 15:31</label></td>
							</tr>
							<tr>
								<td align="right">出发地：</td>
								<td><label id="leaveAddress">巴里坤经营部下涝坝加油站</label></td>
								<td align="right">目的地：</td>
								<td><label id="arriveAddress">轮台绿洲</label></td>
								<td class="more_less">
									
									<span onclick="more1()" class="more1" style="color: rgb(70, 130, 180);">
										更多
										<img src="../../images/gengduo.gif">
									</span>
									<span onclick="less1()" class="less1" style="display: none;color: rgb(70, 130, 180);">
										收起
										<img src="../../images/shouqi.gif">
									</span>
								</td>
							</tr>
						</tbody>
					</table>
					 <div class="easyui-tabs tasb2" style="width:800px;height:340px;display: none;">
						<div title="任务详情" style="padding:10px">
							<table style="width: 100%;">
								<tbody>
									<tr>
										<td align="right" style="width: 95px;">任务类型：</td>
										<td style="width: 350px;"><label>公车</label></td>
										<td align="right" style="width: 100px;">任务状态：</td>
										<td><label>部门审批完成</label></td>
									</tr>
									<tr>
										<td align="right">申请人：</td>
										<td><label>辽阳石化演示</label></td>
										<td align="right">优先级别：</td>
										<td><label>普通</label></td>
									</tr>
									<tr>
										<td align="right">申请单位：</td>
										<td><label>中国石油辽阳石油化纤公司</label></td>
										<td align="right">申请时间：</td>
										<td><label>2017-07-26</label></td>
										<td>&nbsp;</td>
									</tr>
									<tr>
										<td align="right">单程里程：</td>
										<td><label>&lt;400km</label></td>
									</tr>
									<tr>
										<td align="right">用车负责人：</td>
										<td><label></label></td>
										<td align="right">用车负责人电话：</td>
										<td><label></label></td>
									</tr>
									<tr>
										<td align="right">候车位置：</td>
										<td><label></label></td>
										<td align="right">乘车人数：</td>
										<td><label></label></td>
									</tr>
									<tr>
										<td align="right">用车人列表：</td>
										<td colspan="3"></td>
									</tr>
									<tr>
										<td align="right">用车部门：</td>
										<td><label>中国石油辽阳石油化纤公司</label></td>
										<td align="right">风险等级：</td>
										<td>
											驾驶员：<label>A</label> 车辆：
											<label>A</label> 任务：
											<label>A</label>
										</td>
									</tr>
									<tr>
										<td align="right">道路类型：</td>
										<td><label></label></td>
										<td align="right">天气情况：</td>
										<td><label></label></td>
									</tr>
									<tr>
										<td align="right">过路费：</td>
										<td><label></label></td>
										<td align="right">派车人：</td>
										<td><label></label></td>
									</tr>
									<tr style="display: none;">
										<td align="right">订单编号：</td>
										<td><label></label></td>
										<td align="right">发货编号：</td>
										<td><label></label></td>
									</tr>
									<tr style="display: none;">
										<td align="right">商品名称：</td>
										<td colspan="3"><label id="goodsName"></label></td>
									</tr>
									<tr style="display: none;">
										<td align="right">是否工作日：</td>
										<td><label>工作日</label></td>
										<td align="right">是否节假日：</td>
										<td><label></label></td>
									</tr>
									<tr style="display: none;">
										<td style="algin: right;">发车频率：</td>
										<td colspan="3"><label id="frequency"></label></td>
									</tr>
									<tr>
										<td align="right">需求车辆：</td>
										<td colspan="3"><label> 小客车*1</label></td>
									</tr>
									<tr>
										<td align="right">任务途经点：</td>
										<td colspan="3"><label></label></td>
									</tr>
									<tr>
										<td align="right">备注：</td>
										<td colspan="3"><label></label></td>
									</tr>
								</tbody>
							</table>
	
						</div>
						<div title="运能运力分析详情" style="padding:10px">
							<div>
								时间：<input class="easyui-datetimebox" id="startDateC" editable="false" style="width: 150px; display: none;"> 到 <input class="easyui-datetimebox" id="endDateC" editable="false" style="width: 150px; display: none;">
								<a href="#" id="search_btn" class="easyui-linkbutton" iconcls="icon-search">查询</a>
							</div>
							<table class="easyui-datagrid" style="width:100%;height:230px" data-options="rownumbers:true,singleSelect:false,pagination:true,pageList:[5,10,15,20],url:'../../json/not_dis_yunneng.json',method:'get'">
								<thead>
									<tr>
										<th data-options="field:'typeId',width:200">车辆类型</th>
										<th data-options="field:'modelId',width:120">类型</th>
										<th data-options="field:'vehNum',width:200">空闲车辆(辆)</th>
										<th data-options="field:'authorizerCapacity',width:200">限载人数(人/辆)</th>
									</tr>
								</thead>
						</table>
						</div>
						<div title="相关天气预报信息" style="padding:10px">
							<table class="easyui-datagrid" style="width:100%;height:280px" data-options="url:'../../json/not_dis_sky.json',method:'get'">
								<thead>
									<tr>
										<th data-options="field:'provinceName'">城市名称</th>
										<th data-options="field:'detailDate'">预报日期</th>
										<th data-options="field:'dayWeatherInfo'">白天气象</th>
										<th data-options="field:'dayTemperature'">白天温度</th>
										<th data-options="field:'dayDirect'">白天风力</th>
										<th data-options="field:'nightWeatherInfo'">晚间气象</th>
										<th data-options="field:'nightTemperature'">晚间温度</th>
										<th data-options="field:'nightDirect'">晚间风向</th>
										<th data-options="field:'nightDirectPower'">晚间风力</th>
										<th data-options="field:'recordorName'">数据来源</th>
									</tr>
								</thead>
							</table>
						</div>
						<div title="相关天气预警信息" style="padding:10px">
							<table class="easyui-datagrid" style="width:100%;height:280px" data-options="url:'../../json/not_dis_yujing.json',method:'get'">
								<thead>
									<tr>
										<th data-options="field:'provinceName'">省份名称</th>
										<th data-options="field:'cityName'">城市名称</th>
										<th data-options="field:'alarmLvl'">预警等级</th>
										<th data-options="field:'alarmType'">预警类型</th>
										<th data-options="field:'alarmTime'">预警时间</th>
										<th data-options="field:'recordorName'">数据来源</th>
									</tr>
								</thead>
							</table>
						</div>
						<div title="相关路况信息" style="padding:10px">
							<table class="easyui-datagrid" style="width:100%;height:280px" data-options="url:'../../json/not_dis_lukuang.json',method:'get'">
								<thead>
									<tr>
										<th data-options="field:'line_name',width:150">线路名称</th>
										<th data-options="field:'line_id',width:150">线路标示</th>
										<th data-options="field:'f_start_time',width:150">开始时间</th>
										<th data-options="field:'r_end_time',width:150">结束时间</th>
										<th data-options="field:'recordor_name',width:150">数据来源</th>
									</tr>
								</thead>
							</table>
						</div>
						<div title="相关地质灾害信息" style="padding:10px">
							<table class="easyui-datagrid" style="width:100%;height:280px" data-options="url:'../../json/not_dis_dizhi.json',method:'get'">
								<thead>
									<tr>
										<th data-options="field:'address'">发震地址</th>
										<th data-options="field:'lon'">经度</th>
										<th data-options="field:'lat'">纬度</th>
										<th data-options="field:'desaster_lvl'">地震等级</th>
										<th data-options="field:'alt'">深度</th>
										<th data-options="field:'happen_time'">发震时间</th>
										<th data-options="field:'recordorName'">数据来源</th>
									</tr>
								</thead>
							</table>
						</div>
					</div>
				</div>
	            <div id="p4" class="easyui-panel" title="调派列表" style="width:100%; border: none;overflow: hidden;" data-options="collapsible:true">
					<div id="dataTable_toolbar" style="padding: 5px; height: auto">
						<div id="LINESHOW">
							已选路线：<font color="red" size="3">*</font><label id="lineshow"></label>				
						</div>
						<a href="#" id="btnAddVeh" class="easyui-linkbutton clear_btn" iconcls="icon-add" onclick="alert('#dlg1')">新增车辆</a>
						<a href="#" id="btndelVeh" class="easyui-linkbutton del_list clear_btn" iconcls="icon-remove">删除车辆</a> 
						<a href="#" id="btnupdateDriver" class="easyui-linkbutton clear_btn" iconcls="icon-edit">修改驾驶员</a>
						<a href="#" id="btnupdateTime" class="easyui-linkbutton clear_btn" iconcls="icon-edit">修改发车时间</a>
						<a href="#" id="btnupdateLine" class="easyui-linkbutton clear_btn" iconcls="icon-add" onclick="alert('#dlg4')">选择路线</a>
						<a href="#" id="btnSave" class="easyui-linkbutton" iconcls="icon-ok">保存</a>
						<a href="#" id="btnWorkFlow" class="easyui-linkbutton clear_btn" iconcls="icon-d_dpsplb">保存并通知派发</a>
						<a href="#" id="btnCancel" class="easyui-linkbutton" iconcls="icon-return" onclick="child_layout()">返回</a>
				    </div>	
				    <table id="dg3" class="easyui-datagrid" style="width:100%;height:210px" data-options="fitColumns:true,singleSelect:false,collapsible:false,rownumbers:true,pagination:true,pageList:[5,10,15,20],url:'../../json/view_assig.json',method:'get'">
						<thead>
							<tr>
								<th data-options="field:'checkbox',checkbox:true"></th>
								<th data-options="field:'DANWEI',width:200">单位</th>
								<th data-options="field:'car_number',width:200">车牌号</th>
								<th data-options="field:'car_type',width:200">车辆类型</th>
								<th data-options="field:'car',width:200">车型</th>
								<th data-options="field:'person',width:200">载人</th>
								<th data-options="field:'data',width:200">发车时间</th>
								<th data-options="field:'driver',width:200">驾驶员</th>
								<th data-options="field:'driver_eleve',width:200">驾驶员级别</th>
							</tr>
						</thead>
					</table>
					<!--模态框--> 
					<div id='dlg1' class="easyui-window" closed='true' title="选择车辆" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:980px;height:500px;">
						<div> 
							<table border="0" cellspacing="0" cellpadding="0" class="table_mes clear_box">
								<tr>
									<td align="center">单位：</td>
									<td><input id="cc" style="width: 120px;" class="easyui-combotree" data-options="url:'../../json/tree_data1.json',method:'get',required:false"></td>
									<td>
										车辆类型：
										<select class="easyui-combobox width" name="language">
											<option value="ar">小客车(越野6-8座)</option>
											<option value="bg">小客车(商务6-8座)</option>
											<option value="ca">中、大型客车(依维柯9座)</option>
											<option value="zh-cht">中、大型客车(依维柯10座)</option>
											<option value="cs">中、大型客车(依维柯14座)</option>
											<option value="da">中、大型客车(奔驰丰田)</option>
										</select>
									</td>
									<td>车牌号码：</td>
									<td><input type="text"/></td>
								</tr>
								<tr>
									<td align="center">时间：</td>
									<td colspan="2">
										<input id="useDate" style="width: 120px;" class="easyui-datetimebox" editable="false" comboname="useDate">
								                  到<input id="backDate" style="width: 120px;" class="easyui-datetimebox combo-f datetimebox-f datebox-f" editable="false"comboname="backDate">
									</td>
								    <td colspan="2" class="btn">
										<span class="refreshbtn" onclick="refreshbtn('#dg2')">查询</span>
										<span class="refreshbtn" onclick="clearSearch('#dg2')">重置</span>
									</td>
								</tr>
							</table>
							<table id="dg2" class="easyui-datagrid" style="width:100%;height:320px" data-options="fitColumns:true,rownumbers:true,singleSelect:true,pagination:true,pageList:[5,10,15,20],url:'../../json/car_number.json',method:'get'">
				            	<thead>
									<tr>
										<th data-options="field:'orgName',width:200">单位</th>
										<th data-options="field:'typeName',width:200">车辆类型</th>
										<th data-options="field:'idNumber',width:200">车牌号</th>
										<th data-options="field:'modelId',width:200">型号</th>
										<th data-options="field:'driverId',width:200">载客</th>
										<th data-options="field:'driverName',width:200">主驾驶员</th>
										<th data-options="field:'levelName',width:200">驾驶员级别</th>
									</tr>
								</thead>
							</table>
						</div>
						<div style="width:100%; text-align: center;margin-top: 10px;">
							<a href="#" class="easyui-linkbutton add_list" onclick="$('#dlg1').window('close')">确定</a>
							<a href="#" class="easyui-linkbutton" onclick="$('#dlg1').window('close')">关闭</a>
						</div>
					</div>
					<div id='dlg2' class="easyui-window" closed='true' title="选择驾驶员" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:980px;height:500px;">
						<div> 
							<table border="0" cellspacing="0" cellpadding="0" class="table_mes" style="width: 100%;">
								<tr>
									<td align="center">驾驶员名称：</td>
									<td class="drive_input">
										<input type='text'/>
									</td>
									<td align="right">时间：</td>
									<td>
										<input id="useDate" style="width: 120px;" class="easyui-datetimebox" editable="false" comboname="useDate">
										到<input id="backDate" style="width: 120px;" class="easyui-datetimebox combo-f datetimebox-f datebox-f" editable="false"comboname="backDate">
									</td>
								    <td colspan="2" class="btn">
										<span class="refreshbtn" onclick="refreshbtn('#dg')">查询</span>
										<span class="refreshbtn" onclick="clearSearch('#dg')">重置</span>
									</td>
								</tr>
							</table>
							<table id="dg" class="easyui-datagrid" style="width:100%;height:340px" data-options="fitColumns:true,rownumbers:true,singleSelect:true,pagination:true,pageList:[5,10,15,20],url:'../../json/select_driver.json',method:'get'">
				            	<thead>
									<tr>
										<th data-options="field:'ORG_NAME',width:240">所属单位</th>
										<th data-options="field:'DRIVER_NAME',width:240">驾驶员名称</th>
										<th data-options="field:'MOBILEPHONE',width:240">移动电话</th>
										<th data-options="field:'LEVEL_NAME',width:240">级别</th>
									</tr>
								</thead>
							</table>
						</div>
						<div style="width:100%; text-align: center;margin-top: 10px;">
							<a href="#" class="easyui-linkbutton driver_btn" onclick="$('#dlg2').window('close')">确定</a>
							<a href="#" class="easyui-linkbutton" onclick="$('#dlg2').window('close')">关闭</a>
						</div>
					</div>
					
		
					<div id='dlg3' class="easyui-window" closed='true' title="修改发车时间" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:400px;height:180px;">
						<div> 
							<table border="0" cellspacing="0" cellpadding="0" class="table_mes" style="width: 100%;">
								<tr>
									<td align="center">发车时间：</td>
									<td class="time_xiugai">
										<input style='width: 120px;' class='easyui-datetimebox' editable='false' comboname='useDate'>
									</td>
								</tr>
							</table>
						</div>
						<div style="width:100%; text-align: center;margin-top: 10px;">
							<a href="#" class="easyui-linkbutton xiugai_btn">确定</a>
							<a href="#" class="easyui-linkbutton" onclick="$('#dlg3').window('close')">关闭</a>
						</div>
					</div>
				
					<div id='dlg4' class="easyui-window" closed='true' title="选择路线" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:940px;height:500px;">
						<div> 
							<table border="0" cellspacing="0" cellpadding="0" class="table_mes" style="width: 100%;">
								<tr align="right">
									<td>路线名称：</td>
									<td><input type="text" class="input_width"/></td>
									<td>路线起点：</td>
									<td><input type="text"class="input_width" /></td>
									<td>路线终点：</td>
									<td><input type="text" class="input_width"/></td>
									<td>途经点：</td>
									<td><input type="text" class="input_width"/></td>
									<td colspan="2" class="btn">
										<span class="refreshbtn" onclick="refreshbtn('#tdb_dg')">查询</span>
										<span class="refreshbtn" onclick="clearSearch('#tdb_dg')">重置</span>
									</td>
								</tr>
							</table>
							<table id="tdb_dg" class="easyui-datagrid" style="width:100%;height:340px" data-options="fitColumns:true,url:'../../json/alarm_record.json',method:'get'">
				            	<thead>
									<tr>
										<th data-options="field:'orgName',width:90">单位</th>
										<th data-options="field:'idNumber',width:90">车牌号</th>
										<th data-options="field:'listprice',width:90">自编号</th>
										<th data-options="field:'alarmId',width:90">报警编号</th>
										<th data-options="field:'alarmTypeName',width:90">报警类型</th>
										<th data-options="field:'alarmLvl',width:90">报警级别</th>
										<th data-options="field:'address',width:90">报警位置</th>
										<th data-options="field:'alarmDesc',width:90">报警描述</th>
										<th data-options="field:'alarmLvl',width:90">处理状态</th>
										<th data-options="field:'alarmDate',width:90">报警时间</th>
										<th data-options="field:'endDate',width:90">报警结束时间</th>
									</tr>
								</thead>
							</table>
						</div>
						
						<div style="width:100%; text-align: center;margin-top: 10px;">
							<a href="#" class="easyui-linkbutton" onclick="$('#dlg4').window('close')">确定</a>
							<a href="#" class="easyui-linkbutton" onclick="$('#dlg4').window('close')">关闭</a>
						</div>
					</div>
				    <div id='dlg5' class="easyui-window" closed='true' title="提示" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:300px;height:140px;">
						<div style="padding: 10px;"> 
							请选择一条数据！
						</div>
						<div style="width:100%; text-align: center;margin-top: 10px;">
							<a href="#" class="easyui-linkbutton" onclick="$('#dlg5').window('close')">确定</a>
							<a href="#" class="easyui-linkbutton" onclick="$('#dlg5').window('close')">关闭</a>
						</div>
					</div>
				    <div id='dlg6' class="easyui-window" closed='true' title="删除确认" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:300px;height:140px;">
						<div style="padding: 10px;"> 
							您确定要删除此数据吗？
						</div>
						<div style="width:100%; text-align: center;margin-top: 10px;">
							<a href="#" class="easyui-linkbutton delList" onclick="$('#dlg6').window('close')">确定</a>
							<a href="#" class="easyui-linkbutton" onclick="$('#dlg6').window('close')">关闭</a>
						</div>
					</div>
				
	            </div>
		    </div>
		</div>
		<span id="not" style="display: none;">not_dispat</span>
	</body>
	<script type="text/javascript">
//添加数据
	 $('.add_list').click(function(){
	 	$('#dg3').datagrid('insertRow',{
		    index: 2,  // 索引从0开始
		    row: {
		        DANWEI: '指挥车',
		        car_number: '蒙D55717',
		        car_type: '小客车',
		        car: '',
		        person: '',
		        data: '2017-09-16 12:22:10',
		        driver: '',
		        driver_eleve: ''
		    }
		});
	 })
//返回
    function child_layout(){
    	var id = sessionStorage.getItem('id');
        console.log(id)
        var not = JSON.stringify($('#not').html());
    	if(id == not){
    		window.location.href='not_dispat.html';
    		sessionStorage.removeItem('id');
    	}else{
    		window.location.href='../../vehicleScheduling/taskDetails.html';
    	}
    	
    }
// 删除车辆数据  
$('.del_list').click(function() {
	var rowIndex = $('#dg3').datagrid('getSelected');
	if(rowIndex == null) {
		$('#dlg5').window('open');
	} else if(rowIndex != null) {
		$('#dlg6').window('open');
	}
})
//修改驾驶员
$('#btnupdateDriver').click(function() {
	var rowIndex = $('#dg3').datagrid('getSelected');
	if(rowIndex == null) {
	 $('#dlg5').window('open');
	} else if(rowIndex != null) {
		$('#dlg2').window('open');
	}	
})


$(function(){
	$('#dg3').datagrid({
		onSelect: function(rowIndex, rowData){
			var time =rowData.data;
			var drive =rowData.driver;
			$('.time_xiugai').find('input').attr("index",""+rowIndex+"");
			$('.time_xiugai').find('input').val(time);
			
			$('.drive_input').find('input').attr("index",""+rowIndex+"");
			$('.drive_input').find('input').val(drive);
		 }
   });
	$('#dg').datagrid({
		onSelect: function(rowIndex, rowData){
			var name =rowData.DRIVER_NAME;
		    $('.drive_input').find('input').val(name);
		 }
   });
})
//修改发车时间
$('#btnupdateTime').click(function() {
	var rowIndex = $('#dg3').datagrid('getSelected');
	if(rowIndex == null) {
	   $('#dlg5').window('open');
	} else if(rowIndex != null) {
		$('#dlg3').window('open');
	}
})
//点击按钮修改时间
$('.xiugai_btn').click(function(){
	var i = $('.time_xiugai').find('input').attr("index");
	var text =$('.time_xiugai').find('input').val();
	var oldTime = (new Date(""+text+"")).getTime(); //转换成毫秒
	var dataTime= new Date(oldTime) //转换成年月日时间
    Date.prototype.toLocaleString = function() {
          return this.getFullYear() + "-" + (this.getMonth() + 1) + "-" + this.getDate() + " " + this.getHours() + ":" + this.getMinutes() + ":" + this.getSeconds();
    };
    var curTime = dataTime.toLocaleString();
	var trs = $('#dg3').prev().find('div.datagrid-body').find('tr');     
    trs[i].cells[6].firstChild.innerHTML = curTime
    $('#dlg3').window('close');
})

//修改驾驶员按钮
$('.driver_btn').click(function(){
	var i = $('.drive_input').find('input').attr("index");
	var text =$('.drive_input').find('input').val();
	var trs = $('#dg3').prev().find('div.datagrid-body').find('tr');     
    trs[i].cells[7].firstChild.innerHTML = text;
})
$('.delList').click(function() {
	deleteRows('#dg3');
})
//	展开收起
	function more1() {
	    $('.tasb2').show()
		$('.less1').show()
		$('.more1').hide()
	}
	function less1() {	
		$('.tasb2').hide()
		$('.less1').hide()
		$('.more1').show()
	}
//		提示框
		   $('#d').tooltip({
		    content: '<div>'+
		          '<p>1、湖蓝色背景方格是[主驾驶员列]</P>'+
		          '<p>2、如果是长途任务，石青色背景方格是[副驾驶员列]</P>'+
		          '<p>3、默认显示任务需要的车辆类型和数量</P>'+
		          '<p>4、简单调派最多查询1000辆车辆</P>'+
		          '<p>5、车辆列表下面输入查询数量，点击[刷新]按钮重新查询</P>'+
		          '<p>6、驾驶员列表下面工具提示[上一页][下一页][转到]指定页数操作</P>'+
		          '</div>',
		});
	</script>

</html>
