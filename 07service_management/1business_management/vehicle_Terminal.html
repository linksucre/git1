<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>终端管理</title>
		<link href="../../images/logo.png" rel="shortcut icon" />
		<link rel="import" href="../../public.html">
		<script type="text/javascript" src="../../js/loading.js"></script>
		<script type="text/javascript" src="../../js/fenye.js"></script>
		  <style>
		  	.search{
				height: 13px;
				width:150px;
				display: inline-block;
				position: relative;
				padding-bottom: 10px;
			}
			.qingchu{
				width: 16px;
		    height: 21px;
		    top: 0;
		    right: 15px;
		    background: url(../../images/panel_tools.png) no-repeat;
		    background-size:48px 32px;
				background-position: -16px 3px;
				display: none;	
				position: absolute;
		}
		  </style>
	</head>
	<body>
		<!--弹框-->
			<!--添加-->
				<div id='w1' class="easyui-window" closed='true' title="新增终端" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:500px;height:270px;overflow: hidden;">
				<div style="padding: 10px; box-sizing: border-box;">
					<form id="ff" method="post">
							<table>
								<tbody>
									<tr>
									<td>终端编号：</td>
									<td>
										<input type="text" id="terminalCode" name="terminalNum" class="easyui-validatebox textbox validatebox-text validatebox-invalid" style="width: 150px" onblur="return CheckTerminalCode(this);" data-options="validType:['paramCode','length[1,30]']">
										
									</td>
									<td>SIM卡号：</td>
									
									<td>
										<input id="type" class="easyui-combobox" name="simNum" style="width:150px;height:20px;" />	
									</td>
									
								</tr>
								<tr>
									<td>终端类型：</td>
									<td>
										<input id="typeId" class="easyui-combobox" name="simNum" style="width:150px;" />	
										
									</td>
									
									<td>单位：</td>
									<td>
										<div class="clear_mes">
											<input class="easyui-combotree messagesData" name="" data-options="url:'../../json/tree_data1.json',method:'get',required:false" style="width:150px;">
											<span class="clearMess" style="display:none;"></span>
									    </div>
									</td>
								</tr>
								<tr>
									<td>终端回传时间：</td>
									<td>
										<input type="text" id="rinterval" name="returnTime" data-options="validType:'length[0,10]'" style="width: 144px; height: 19px; line-height: 19px;" class="easyui-validatebox easyui-numberbox numberbox numberbox-f validatebox-text" numberboxname="rinterval">
									</td>
								<td>鉴权码：</td>
									<td><input type="text" id="authenticationCode" style="width: 150px;height:20px;margin-bottom:5px;" name="ratifyNum" class="easyui-validatebox textbox validatebox-text validatebox-invalid" data-options="required:true,validType:'length[1,50]'"></td>
								</tr>
								<tr>
									<td>主ip：</td>
									<td>
										<input type="text" id="ip" name="mainIp" class="easyui-validatebox" style="width:147px;height:17px;" data-options="validType:['ip','length[1,32]']">
										
									</td>
									<td>主port：</td>
									<td>
										<input type="text" class="easyui-validatebox " style="width: 147px; height: 20px; line-height: 20px;margin-bottom: 5px;" data-options="validType:['port','length[1,4]']" numberboxname="port">
									</td>
								</tr>
								<tr>
									<td>从ip：</td>
									<td>
										<input type="sip" id="sip" name="salveIp" class="easyui-validatebox" style="width:147px;height:17px" data-options="validType:['ip','length[0,32]']">
									</td>
									<td>从port：</td>
									<td>
										<input type="sport" id="sport" class="easyui-validatebox" style="width: 147px; height: 20px; line-height: 20px;" data-options="validType:['port','length[0,8]']" numberboxname="violationAddress">
									</td>
								</tr>
								<tr>
									<td>开户状态：</td>
									<td>
										<select style="width: 150px; height: 21px; display: none;" id="accountFlag" name="openStatus" class="easyui-combobox" editable="false" comboname="accountFlag"><option value="">请选择</option>
											<option value="1">开通</option>
											<option value="0">未开通</option>
										</select>
								</tr>
								<tr align="center">
									<td colspan="5">
										<input type="submit" value="确定" class="add easyui-linkbutton" />
										<input type="button" value="关闭" class="easyui-linkbutton" onclick="$('#w1').window('close')" />
									</td>
								</tr>
								</tbody>
							</table>
		
					</form>
				</div>
			</div>
			<div id='w2' class="easyui-window" closed='true' title="提示信息" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:300px;height:120px;">
			<div style="width:100%;box-sizing: border-box; padding: 5px 0 0 10px;">
				请选择一条记录！
			</div>
			<div style="width:100%; text-align: center;margin-top: 10px;">
				<a href="#" class="easyui-linkbutton" onclick="$('#w2').window('close')">确定</a>
			</div>
		</div>
			<div id='w3' class="easyui-window" closed='true' title="提示信息" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:300px;height:120px;">
			<div style="width:100%;box-sizing: border-box; padding: 5px 0 0 10px;">
				数据来源为ERP的数据不可修改!
			</div>
			<div style="width:100%; text-align: center;margin-top: 10px;">
				<a href="#" class="easyui-linkbutton" onclick="$('#w3').window('close')">确定</a>
			</div>
		</div>
		<div id='w5' class="easyui-window" closed='true' title="提示信息" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:300px;height:120px;">
			<div style="width:100%;box-sizing: border-box; padding: 5px 0 0 10px;">
				你选择的数据过多，修改只能一次修改一条数据！
			</div>
			<div style="width:100%; text-align: center;margin-top: 10px;">
				<a href="#" class="easyui-linkbutton" onclick="$('#w5').window('close')">确定</a>
			</div>
		</div>
		<div id='w6' class="easyui-window" closed='true' title="修改终端(提示:该记录来自ERP系统，不能进行修改。)" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:500px;height:270px;overflow: hidden;">
				<div style="padding: 10px; box-sizing: border-box;">
					<form id="ff" method="post">
							<table>
								<tbody>
									<tr>
									<td>终端编号：</td>
									<td>
										<input type="text" id="terminalCode" name="terminalNum" class="easyui-validatebox textbox validatebox-text validatebox-invalid" style="width: 150px" onblur="return CheckTerminalCode(this);" data-options="validType:['paramCode','length[1,30]']">
									</td>
									<td>SIM卡号：</td>
									
									<td>
										<input id="type" class="easyui-combobox" name="simNum" style="width:150px;height:20px;" />	
									</td>
									
								</tr>
								<tr>
									<td>终端类型：</td>
									<td>
										<input id="typeId" class="easyui-combobox" name="simNum" style="width:150px;" disabled="disabled"/>	
										
									</td>
									
									<td>单位：</td>
									<td>
									<div class="search">
									 	<input type="text" class="easyui-combotree" name="unitId" comboname="orgCode" style="width:150px;height:20px;border:1px solid #95b8e7;" data-options="url:'get_data.php',url:'../../json/alarmSwitchdanwei.json',method:'get'">
										<span class="combo-clear qingchu"></span>
									</div>
									</td>
								</tr>
								<tr>
									<td>终端回传时间：</td>
									<td>
										<input type="text" id="rinterval" name="returnTime" data-options="validType:'length[0,10]'" style="width: 144px; height: 19px; line-height: 19px;" class="easyui-validatebox easyui-numberbox numberbox numberbox-f validatebox-text" numberboxname="rinterval">
									</td>
								<td>鉴权码：</td>
									<td><input type="text" id="authenticationCode" style="width: 150px;height:20px;margin-bottom:5px;" name="ratifyNum" class="easyui-validatebox textbox validatebox-text validatebox-invalid" data-options="required:true,validType:'length[1,50]'"></td>
								</tr>
								<tr>
									<td>主ip：</td>
									<td>
										<input type="text" id="ip" name="mainIp" class="easyui-validatebox" style="width:147px;height:17px;" data-options="validType:['ip','length[1,32]']">
										
									</td>
									<td>主port：</td>
									<td>
										<input type="text" class="easyui-validatebox " style="width: 147px; height: 20px; line-height: 20px;margin-bottom: 5px;" data-options="validType:['port','length[1,4]']" numberboxname="port">
									</td>
								</tr>
								<tr>
									<td>从ip：</td>
									<td>
										<input type="sip" id="sip" name="salveIp" class="easyui-validatebox" style="width:147px;height:17px" data-options="validType:['ip','length[0,32]']">
									</td>
									<td>从port：</td>
									<td>
										<input type="sport" id="sport" class="easyui-validatebox" style="width: 147px; height: 20px; line-height: 20px;" data-options="validType:['port','length[0,8]']" numberboxname="violationAddress">
									</td>
								</tr>
								<tr>
									<td>开户状态：</td>
									<td>
										<select style="width: 150px; height: 21px; display: none;" id="accountFlag" name="openStatus" class="easyui-combobox" editable="false" comboname="accountFlag"><option value="">请选择</option>
											<option value="1">开通</option>
											<option value="0">未开通</option>
										</select>
								</tr>
								<tr>
									<td>用途：</td>
									<td>
										<select style="width: 150px; height: 21px; display: none;" id="accountFlag" name="openStatus" class="easyui-combobox" editable="false" comboname="accountFlag"><option value="">请选择</option>
											<option value="1">请选择</option>
											<option value="1">视屏终端</option>
											<option value="0">普通GPS终端</option>
										</select>
								</tr>
								<tr align="center">
									<td colspan="5">
										<input type="submit" value="确定" class="add easyui-linkbutton" />
										<input type="button" value="关闭" class="easyui-linkbutton" onclick="$('#w6').window('close')" />
									</td>
								</tr>
								</tbody>
							</table>
		
					</form>
				</div>
			</div>
			<form  id="searchForm">
				<div id="clear_box" style="padding: 5px; height: auto" class="datagrid-toolbar">
				单位：
				<div class="search">
					<input type="text" class="easyui-combotree" name="unitId" comboname="orgCode" style="width:150px;height:20px;border:1px solid #95b8e7;" data-options="url:'get_data.php',url:'../../json/alarmSwitchdanwei.json',method:'get'">
					<span class="combo-clear qingchu"></span>
				</div>
				SIM卡号：
				<input type="text" name="simNum" id="simNum5" class="easyui-validatebox textbox validatebox-text" style="width: 96px">
				 终端类型：
				<select style="width: 140px; display: none;" name="typeId" id="terminalType5" class="easyui-combobox combobox-f combo-f" editable="false" comboname="terminalType"></select>
				终端编号：
				<input type="text" name="terminalNum" id="terminalCode6" class="easyui-validatebox textbox validatebox-text" style="width: 96px"> 
					信息来源：
				<select style="width: 150px; display: none;" id="dataFrom5" class="easyui-combobox combobox-f combo-f" editable="false" comboname="dataFrom5">
					<option value="">请选择</option>
					<option value="E">ERP</option>
					<option value="V">VMS2.0</option>
				</select>
				<span class="easyui-linkbutton" data-options="iconCls:'icon-search'" onclick="refreshbtn('#dg')">查询</span>
				<span class="easyui-linkbutton " iconcls="icon-cz_reset" onclick="clearSearch()">重置</span>
				<span class="easyui-linkbutton " data-options="iconCls:'icon-add'" onclick="alert('#w1')">添加</span>
				<span class="easyui-linkbutton" data-options="iconCls:'icon-edit'" onclick="xiugai('#dg')">修改</span>
				<span class="easyui-linkbutton" data-options="iconCls:'icon-remove'" onclick="del()">删除</span>
				<span class="easyui-linkbutton" data-options="iconCls:'icon-repo'"><a href="#" id="exportExcel">导出</a></span>
				<span class="easyui-linkbutton" data-options="iconCls:'icon-impo'" onclick="alert('#w9')"><a href="#" >导入</a></span>
			</div>
	</form>
    <div  style="width:100%;height:500px;">
    	<table id="dg" class="easyui-datagrid" title="" style="width:100%;height:600px" data-options=""></table>
	
    </div> 
	</body>
	    <script type="text/javascript">
 $(function() {
			$('#dg').datagrid({
				singleSelect: false,
				collapsible: true,
				rownumbers: true,
				pagination: true,
				url: 'http://dayan.huayitec.com/terminalController/getListPage',
				columns: [
					[{
							field: 'checkbox',
							checkbox:true
						},{
							field: 'userNameRel',
							title: '信息来源',
							width: 130,
							align: 'center',
							sortable: true
						},
						{
							field: 'userName',
							title: '终端编码',
							width: 130,
							align: 'center',
							sortable: true
						},
						{
							field: 'typeId',
							title: '终端类型',
							width: 200,
							align: 'center',
							sortable: true
						},
						{
							field: 'simNum',
							title: 'sim卡号',
							width: 130,
							align: 'center',
							sortable: true
						},
						{
							field: 'unitId',
							title: '单位',
							width: 130,
							align: 'center',
							sortable: true
						},
						{
							field: 'terminalNum',
							title: '终端',
							width: 210,
							align: 'center',
							sortable: true
						},
						{
							field: 'openStatus',
							title: '开户状态',
							width: 150,
							align: 'center',
							sortable: true
						},
						{
							field: 'mainIp',
							title: '主ip',
							width: 200,
							align: 'center',
							sortable: true
						},
						{
							field: 'userStatus',
							title: '主port',
							width: 100,
							align: 'center',
							sortable: true
						},
						{
							field: 'returnTime',
							title: '记录时间',
							width: 100,
							align: 'center',
							sortable: true
						}
						
					]
				]
			});
		});
		
		//添加
		$(".add").click(function(){
			$('#ff').form({
			url: 'http://dayan.huayitec.com/terminalController/insert',
				success: function(data) {
					$('#w1').window('close')
					$('#dg').datagrid('reload');
				}
			});
		})
		//   查询		
		function query() {
			$("#dg").datagrid("load", sy.serializeObject($("#searchForm").form())); //将searchForm表单内的元素序列为对象传递到后台
		}
		//点击清空按钮出发事件
function clearSearch(dg) {
    $(dg).datagrid("load", {});//重新加载数据，无填写数据，向后台传递值则为空
    $(".clear_box").find("input").val("");//找到form表单下的所有input标签并清空
  }
		//下拉框
		 initComboboxFn('#type', '../../json/vehicle_Terminal.json');
		  initComboboxFn('#typeId', '../../json/vehicle_Terminal.json');
		  
		  	// 修改           
		function xiugai() {
			//判断是否选中了一条数据
			var rowIndex = $('#dg').datagrid('getSelected');
			if(rowIndex == null) { //没选中
				$('#w2').window('open');
			} else if(rowIndex != null) { //选中
				//是否选中单元格中的未处理
				var ids = [];
				var rows = $('#dg').datagrid('getSelections');
//				var getSelect = $('#dg').datagrid('getData');
				for(var i = 0; i < rows.length; i++) {
					ids.push(rows[i].id);
				}
//				var ids_data = jQuery.inArray('未处理', ids); //返回值 ：0存在  -1不存在
				if(ids.length == 1) {
					$('#w6').window('open');
				} else {
					$('#w5').window('open');
				}
				
			}
		}
      </script>
</html>
