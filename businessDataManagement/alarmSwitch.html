<!DOCTYPE html>
<html>
  <head style="height:100%;">
    <title>报警开关管理</title>
	
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link href="../images/logo.png" rel="shortcut icon" />
	  <link rel="stylesheet" href="../css/easyui.css" type="text/css"/>
	  <link rel="stylesheet" href="../css/icon.css" type="text/css"/>
	  <link rel="stylesheet" href="../css/demo.css" />
	  <link rel="stylesheet" href="../css/index.css" />
	  <link rel="stylesheet" href="../css/common.css" />
	  <link rel="stylesheet" href="../css/self.css" />
	<link rel="stylesheet" href="../css/other.css" />
		<script type="text/javascript" src="../js/jquery.min.js"></script>
		<script type="text/javascript" src="../js/fenye.js"></script>
		  <script type="text/javascript" src="../js/jquery.easyui.min.js"></script>
		  <!-- 引入EasyUI的中文国际化js，让EasyUI支持中文 -->
		  <script type="text/javascript" src="../js/easyui-lang-zh_CN.js"></script>
  </head>

  <body style="width:100%;height:100%;">
  	<!--弹框-->
  			<div id='w' class="easyui-window" closed='true' title="提示信息" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:310px;height:140px;">
			<div class="message" style="padding-top:25px;padding-left:25px;box-sizing: border-box;">	
				<div class="messager-icon messager-question"></div>
				您确认想要修改记录吗?
		    </div>
		
		    <div style="width: 100%;margin-top:10px;">
					<a href="javascript:void(0)" class="easyui-linkbutton add_list" onclick="$('#w').window('close')">确定</a>
					<a href="javascript:void(0)" class="easyui-linkbutton" onclick="$('#w').window('close')">关闭</a>
				</div>
		</div>
  	
  	<div class="clear_box" style="width:100%;height:30px;padding: 5px; height: auto" class="datagrid-toolbar">
		车牌号：
		<input type="text" name="idNumber" id="idNumber" class="easyui-validatebox textbox validatebox-text" style="width: 96px;">
		 单位：
		 <input type="text" class="easyui-combotree" comboname="orgCode" style="width:150px;height:20px;border:1px solid #95b8e7;" data-options="url:'get_data.php',url:'../json/alarmSwitchdanwei.json',method:'get'">
	
	
		<span class="easyui-linkbutton" data-options="iconCls:'icon-search'"  onclick="refreshbtn('#dg')">查询</span>
		<span class="easyui-linkbutton " iconcls="icon-cz_reset" onclick="clearSearch('#clear_box')">重置</span>
			<a id="export_btn" class="easyui-linkbutton" data-options="iconCls:'icon-excel'">
				导出
			</a>
		<a href="#" onclick="alert('#w')" class="easyui-linkbutton" data-options="iconCls:'icon-edit'">
			修改
		</a>
	</div>
    <div  style="width:100%;height:500px;">
    	<table id="dg" class="easyui-datagrid" style="width:100%;height:100%;overflow: hidden;" 
    		data-options="singleSelect:false,pagination:true,pageList:[5,10,15,20],collapsible:true,rownumbers:true,url:'../json/123.json',method:'get'">
	</table>
    </div>  
    <script type="text/javascript">
      $(function() {  
        $('#dg').datagrid({   
            fitColumns : "true",  
            striped : true,  
            rownumbers:true,     
            checkOnSelect : 'true',  
						autoRowHeight:false,
						checkOnSelect:false,
						onLoadSuccess:buttonFun,
						onSortColumn:alertColumn,
						onCheck:function(rowIndex, rowData){ 
									  setStyle(rowIndex)
								},
						onUncheck:function(rowIndex, rowData){ 
							  setStyle2(rowIndex)
						},								
            columns : [ [ {  
                field : 'itemid',  
                title : 'Order ID',  
                width : 200, 
                height:1000,
                checkbox : true  
           		},{
                    field: 'idNumber',
                    title: '车牌号',
                    width: 50, 
               		 align : 'right'
                    
                },{
                    field: 'orgName',
                    title: '单位',
                    width: 50, 
               		 align : 'right'
                    
                },{
                    field: 'b62',
                    
                    sortable:true,
                    title: '<input id="b48" class=\"detailcheckbox\" type=\"checkbox\" />限时行车报警',
                    width: 30, 
               		 align : 'left'
                    
                },{
                    field: 'b63',
                    sortable:true,
                    title: '<input class=\"detailcheckbox\" type=\"checkbox\"  >疲劳驾驶报警 ',
                    width: 30, 
               		 align : 'left'
                    
                },{
                    field: 'b60',
                    sortable:true,
                    title: '<input class=\"detailcheckbox\" type=\"checkbox\"  >异常停车报警',
                    width: 30, 
               		 align : 'left'
                    
                },{
                    field: 'b56',
                    sortable:true,
                    title: '<input class=\"detailcheckbox\" type=\"checkbox\"  >禁止驶出报警',
                    width: 30, 
               		 align : 'left'
                    
                },{
                    field: 'b19',
                    sortable:true,
//                  formatter:formatPrice,
                    title: '<input class=\"detailcheckbox\" type=\"checkbox\"  >禁止停车区报警',
                    width: 30, 
               		 align : 'left'
                    
                },{
                    field: 'b55',
                    sortable:true,
                    title: '<input class=\"detailcheckbox\" type=\"checkbox\"  >停车超时报警',
                    width: 30, 
               		 align : 'left'
                    
                },{
                    field: 'b54',
                    sortable:true,
                    title: '<input class=\"detailcheckbox\" type=\"checkbox\"  >偏离路线报警',
                    width: 30, 
               		 align : 'left'
                    
                },{
                    field: 'b17',
                    sortable:true,
                    title: '<input class=\"detailcheckbox\" type=\"checkbox\"  >终端异常报警',
                    width: 30, 
               		 align : 'left'
                    
                },{
                    field: 'b13',
                    sortable:true,
                    title: '<input class=\"detailcheckbox\" type=\"checkbox\"  >分段限速报警',
                    width: 30, 
               		 align : 'left'
                    
                },{
                    field: 'b11',
                    sortable:true,
                    title: '<input class=\"detailcheckbox\" type=\"checkbox\"  >路线关键点预警',
                    width: 30, 
               		 align : 'left'
                    
                },{
                    field: 'b10',
                    sortable:true,
                    title: '<input class=\"detailcheckbox\" type=\"checkbox\"  >风险区预警',
                    width: 30, 
               		 align : 'left'
                    
                },{  
                field : 'b15',  
                sortable:true,
                title: '<input class=\"detailcheckbox\" type=\"checkbox\"  >盲区预警',
                width : 30,  
                align : 'left'  
            }] ]  
        });  
    function alertColumn(sort,order){  
        formatPrice(sort,order)
    }  
    function formatPrice(val,row){
			      return '<input type="button" value="'+val+'" onclick="tab_mes(this)" style="dispaly:inline-block;width:30px;height:100%;background: green;color:#ffffff;">';
//			           return '<input type="button" value="√" onclick="tab_mes(this)" style="dispaly:inline-block;width:30px;height:100%;background: green;color:#ffffff;">';
			       
			    }
    function buttonFun(rowIndex) {
		 	     	var trs = $(this).prev().find('div.datagrid-body').find('tr');
			            for(var i=0; i<trs.length; i++){
			             	for(var j=3; j<15; j++){
				            	if(trs[i].cells[j].firstChild.innerHTML == '1'){
				            		 trs[i].cells[j].firstChild.innerHTML = '<input type="button" value="√" onclick="tab_mes(this)" style="dispaly:inline-block;width:30px;height:100%;background: green;color:#ffffff;">';
				                }else if(trs[i].cells[j].firstChild.innerHTML == '0'){
				                	trs[i].cells[j].firstChild.innerHTML = '<input type="button" value="X" onclick="tab_mes(this)" style="dispaly:inline-block;width:30px;height:100%;background: red;color:#ffffff;">';
				                }
			                }
				        }   					    
		 	     
   }
   
     function setStyle(rowIndex) {
//   	alert(1)
            var trs = $('#dg').prev().find('div.datagrid-body').find('tr');
             for(var i=0; i<trs.length; i++){
 
//        console.log(trs[i].cells)
             		for(var j=3; j<trs[rowIndex].cells.length; j++){
             	console.log(trs[rowIndex].cells[j].firstChild.innerHTML);
             	trs[rowIndex].cells[j].firstChild.innerHTML = '<input type="button" value="X" onclick="tab_mes(this)" style="dispaly:inline-block;width:30px;height:100%;background: red;color:#ffffff;">';

		             }
	        }
        }
     
          function setStyle2(rowIndex) {
//   	alert(1)
            var trs = $('#dg').prev().find('div.datagrid-body').find('tr');
             for(var i=0; i<trs.length; i++){
 
//        console.log(trs[i].cells)
             		for(var j=3; j<trs[rowIndex].cells.length; j++){
             	console.log(trs[rowIndex].cells[j].firstChild.innerHTML);
             	trs[rowIndex].cells[j].firstChild.innerHTML = '<input type="button" value="√" onclick="tab_mes(this)" style="dispaly:inline-block;width:30px;height:100%;background: green;color:#ffffff;">';

		             }
	        }
        }
          
    $('#dg').datagrid({
	onClickCell: function(index,field,value){

	}
});
    function getData(){
			var rows = [];
			for(var i=1; i<=800; i++){
				var amount = Math.floor(Math.random()*1000);
				var price = Math.floor(Math.random()*1000);
				rows.push({
					inv: 'Inv No '+i,
					date: $.fn.datebox.defaults.formatter(new Date()),
					name: 'Name '+i,
					amount: amount,
					price: price,
					cost: amount*price,
					note: 'Note '+i
				});
			}
			return rows;
		}
		
		function pagerFilter(data){
			if (typeof data.length == 'number' && typeof data.splice == 'function'){	// is array
				data = {
					total: data.length,
					rows: data
				}
			}
			var dg = $(this);
			var opts = dg.datagrid('options');
			var pager = dg.datagrid('getPager');
			pager.pagination({
				onSelectPage:function(pageNum, pageSize){
					opts.pageNumber = pageNum;
					opts.pageSize = pageSize;
					pager.pagination('refresh',{
						pageNumber:pageNum,
						pageSize:pageSize
					});
					dg.datagrid('loadData',data);
				}
			});
			if (!data.originalRows){
				data.originalRows = (data.rows);
			}
			var start = (opts.pageNumber-1)*parseInt(opts.pageSize);
			var end = start + parseInt(opts.pageSize);
			data.rows = (data.originalRows.slice(start, end));
			return data;
		}
		
		$(function(){
			$('#dg').datagrid({loadFilter:pagerFilter}).datagrid('loadData', getData());
		});
	 }); 
	 
	  
	  function tab_mes(e){
	  	console.log($(e).context.defaultValue)
		 	if($(e).context.defaultValue=='√'){
		 		$(e).css({
		 		'background':'red'
		 	})
		 	$(e).context.defaultValue = 'X';
		 	}else if($(e).context.defaultValue=='X'){
		 		$(e).css({
		 		'background':'green'
		 	})
		 	$(e).context.defaultValue = '√';
		 	}
		}
	  
	  //easyui导出
window.onload = function() {
	var tableToExcel = (function() {
		var uri = 'data:application/vnd.ms-excel;base64,',
			template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">' +
			'<head><meta http-equiv="Content-type" content="text/html;charset=UTF-8" /><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/>' +
			'</x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',
			base64 = function(s) {
				return window.btoa(unescape(encodeURIComponent(s)))
			},
			format = function(s, c) {
				return s.replace(/{(\w+)}/g, function(m, p) {
					return c[p];
				})
			};

		return function(table, name) {
			var ctx = {
				worksheet: name || 'Worksheet',
				table: table.innerHTML
			}
			return uri + base64(format(template, ctx));
		}
	})();

	$(function() {
		$('#export_btn').on('click', function() {
			var $this = $(this);
			//设定下载的文件名及后缀
			$this.attr('download', '报警记录.xls');
			//设定下载内容
			$this.attr('href', tableToExcel($('.datagrid-view2')[0], '报警记录'));
		});
	});
}
$("#orgCode").click(function(){
	$('.panel-body-noheader').css("display","block")
})
function getValue(){  
    var value = $('#cc').combotree('getValue');  
    alert(value);  
} 
    </script>
</body>
</html>