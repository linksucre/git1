<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>用户管理</title>
	</head>
	<link rel="import" href="../../public.html">
	<script type="text/javascript" src="../../js/loading.js"></script>
	<script type="text/javascript" src="../../js/fenye.js"></script>

	<body>
		<div class="easyui-layout" data-options="fit:true">
			<div data-options="region:'center',border:true">
				<form action="" id="searchForm">
					<table id="query" border="0" cellspacing="0" cellpadding="0" class="clear_box table_layout">
						<tr>
							<td>用户名登录：</td>
							<td><input type="text" name="userNameRel" class="width1" /></td>
							<td>用户姓名：</td>
							<td><input type="text" name="userName" class="width1" /></td>
							<td>单位名称：</td>
							<td><input id="cc" name="userUnitName" class="easyui-combotree" data-options="url:'../../json/tree_data1.json',method:'get',required:false" style="width:120px;"></td>
							
							<td>手机号</td>
							<td><input type="text" name="userPhone" class="width1"></input>
							</td>
							<td> <input type="checkbox" style="vertical-align: middle;" /> 仅显示已删除用户</td>
							<td style="padding-left: 5px;">
								<span class="easyui-linkbutton" iconcls="icon-search" onclick="query()">查询</span>
								<span class="easyui-linkbutton" iconcls="icon-cz_reset" onclick="clearSearch('#dg')">重置</span>
								<span class="easyui-linkbutton add" iconcls="icon-add" onclick="alert('#dlg0')">添加</span>
								<span class="easyui-linkbutton" iconcls="icon-excel"><a id="exportExcel" href="javascript:;">导出</a></span>
							</td>
						</tr>
					</table>
				</form>
				<table id="dg" class="easyui-datagrid" title="" style="width:100%;height:600px" data-options=""></table>
				<!--模态框-->
				<div id='dlg0' class="easyui-window" closed='true' title="新增用户" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:700px;height:320px;">
					<div style="padding: 10px; box-sizing: border-box;">
						<form id="ff" method="post">
							<table style="width: 100%;height: 260px;">
								<tbody>
									<tr>
										<td>用户登录名：</td>
										<td>
											<input type="text" name="userNameRel" id="userName" class="easyui-validatebox" value="56587425" style="width:151px" data-options="required:true">

										</td>
										<td>用户姓名：</td>
										<td><input type="text" name="userName" id="userNameRel" class="easyui-validatebox" value="杜雪" style="width:151px" data-options="required:true"></td>
									</tr>
									<tr>
										<td>座机号：</td>
										<td><input type="text" name="userTel" value="0431-8523648" style="width:151px"></td>
										<td>手机号：</td>
										<td><input type="text" name="userPhone" value="18311465203" style="width:151px"></td>
									</tr>
									<tr>
										<td>单位名称：</td>
										<td><input class="easyui-combotree" name="userUnitName" value="华仪" data-options="url:'../../json/tree_data1.json',method:'get',required:false" style="width:155px;"></td>
										<td>邮箱：</td>
										<td><input type="text" name="userEmail" value="1506069997@qq.com" id="userEmail" class="easyui-validatebox" maxlength="50" style="width:151px" data-options="required:true"></td>
									</tr>
									<tr>
										<td>单位ERP编号：</td>
										<td><input type="text" name="userErpUnit" value="erp01" id="userErpUnit" style="width:151px" data-options="validType:'numberAndABC'" class="easyui-validatebox" maxlength="16"></td>
										<td>用户ERP编号：</td>
										<td><input type="text" name="userErpOrg" value="erp02" id="userErpOrg" style="width:151px" data-options="validType:'numberAndABC'" class="easyui-validatebox" maxlength="16"></td>
									</tr>
									<tr>
										<td>岗位：</td>
										<td>
											<select name="userStatus" class="easyui-combobox">
												<option value="">公司总经理</option>
												<option value="">总调度长</option>
												<option value="">副总调度长</option>
												<option value="">分公司安全科科长</option>
												<option value="">分公司安全科副科长</option>
												<option value="">物资贸易管理处处长</option>
												<option value="">物资贸易管理处副处长</option>
												<option value="">安全环保处副处长</option>
												<option value="">信息管理处处长</option>
												<option value="">信息管理处副处长</option>
												<option value="">总调度室处长助理</option>
												<option value="">物资贸易管理处科长</option>
											</select>
										</td>
									</tr>
									<tr>
										<td>所属角色：</td>
										<td colspan="3">
											<select class="easyui-combobox" style="width: 437px" ;>
												<option value="">分公司监控员</option>
												<option value="">项目监控员</option>
												<option value="">物探公司普通用户</option>
												<option value="">青海油田管理员</option>
												<option value="">青海油田监控员</option>
												<option value="">油建汽服中心</option>
												<option value="">高级管理员</option>
												<option value="">吉林查岗管理</option>
												<option value="">普通用户管理</option>
												<option value="">外管账号</option>
											</select>
										</td>

									</tr>
									<tr align="center">
										<td colspan="5">
											<input class="easyui-linkbutton add_list1" type="submit" value="保存" onclick="search()">
											<input class="easyui-linkbutton" type="button" value="取消">
										</td>

									</tr>
								</tbody>

							</table>
						</form>
					</div>
				</div>
				<div id='dlg' class="easyui-window" closed='true' title="修改用户" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:700px;height:270px;">
					<div style="padding: 10px; box-sizing: border-box;">
						<form method="post" id="update">
							<table style="width: 100%;height: 150px;">
								<tbody>
									<tr>
										<td>用户登录名：</td>
										<td><input type="text" name="userNameRel" id="userNameRel" class="easyui-validatebox" style="width:151px" data-options="required:true"></td>
										<td>用户姓名：</td>
										<td><input type="text" name="userName" id="userName" class="easyui-validatebox" style="width:151px" data-options="required:true"></td>
									</tr>
									<tr>
										<td>座机号：</td>
										<td><input type="text" name="userTel" style="width:151px"></td>
										<td>手机号：</td>
										<td><input type="text" name="userPhone" style="width:151px"></td>
									</tr>
									<tr>
										<td>单位名称：</td>
										<td><input class="easyui-combotree" name="userUnitName" data-options="url:'../../json/tree_data1.json',method:'get',required:false" style="width:155px;"></td>
										<td>邮箱：</td>
										<td><input type="text" name="userEmail" id="userEmail" class="easyui-validatebox" maxlength="50" style="width:151px" data-options="required:true"></td>
									</tr>
									<tr>
										<td>单位ERP编号：</td>
										<td><input type="text" name="userErpUnit" id="gerpCode" style="width:151px" data-options="validType:'numberAndABC'" class="easyui-validatebox" maxlength="16"></td>
										<td>用户ERP编号：</td>
										<td><input type="text" name="userErpOrg" id="userErpCode" style="width:151px" data-options="validType:'numberAndABC'" class="easyui-validatebox" maxlength="16"></td>
									</tr>
									<tr>
										<td>岗位：</td>
										<td>
											<select name="userPost" class="easyui-combobox">
												<option value="">公司总经理</option>
												<option value="">总调度长</option>
												<option value="">副总调度长</option>
												<option value="">分公司安全科科长</option>
												<option value="">分公司安全科副科长</option>
												<option value="">物资贸易管理处处长</option>
												<option value="">物资贸易管理处副处长</option>
												<option value="">安全环保处副处长</option>
												<option value="">信息管理处处长</option>
												<option value="">信息管理处副处长</option>
												<option value="">总调度室处长助理</option>
												<option value="">物资贸易管理处科长</option>
											</select>
										</td>
									</tr>
									<tr>
										<td>所属角色：</td>
										<td colspan="3">
											<select name="userStatus" class="easyui-combobox" style="width: 437px" ;>
												<option value="">分公司监控员</option>
												<option value="">项目监控员</option>
												<option value="">物探公司普通用户</option>
												<option value="">青海油田管理员</option>
												<option value="">青海油田监控员</option>
												<option value="">油建汽服中心</option>
												<option value="">高级管理员</option>
												<option value="">吉林查岗管理</option>
												<option value="">普通用户管理</option>
												<option value="">外管账号</option>
											</select>
										</td>
									</tr>
									<tr align="center">
										<td colspan="4">
											<input type="submit" class="easyui-linkbutton" onclick="modify()" value="保存" />
											<input type="submit" class="easyui-linkbutton" onclick="$('#dlg').window('close')" value="关闭" />
										</td>
									</tr>
								</tbody>
							</table>
						</form>					
					</div>
				</div>
				<div id='dlg1' class="easyui-window" closed='true' title="用户详情" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:540px;height:260px;">
					<div style="padding: 10px; box-sizing: border-box;">
						<form method="post" id="message">
							<table border="0" cellspacing="0" cellpadding="0" style="width: 100%">
								<tbody>
									<tr style="height: 25px">
										<td>用户登录名：</td>
										<td><input type="text" name="userName" readOnly="true" style="border: none;"/></td>
										<td>用户姓名：</td>
										<td>
											<input type="text" name="userNameRel" readOnly="true" style="border: none;"/>
										</td>
									</tr>
									<tr style="height: 25px">
										<td>座机号：</td>
										<td>
											<input type="text" name="userTel" readOnly="true" style="border: none;"/>
										</td>
										<td>手机号：</td>
										<td>
											<input type="text" name="userPhone" readOnly="true" style="border: none;"/>
										</td>
									</tr>
									<tr style="height: 25px">
										<td>组织机构：</td>
										<td>
											<input type="text" name="userName" readOnly="true" style="border: none;"/>
										</td>
										<td>邮箱：</td>
										<td>
											<input type="text" name="userEmail" readOnly="true" style="border: none;"/>							
										</td>
									</tr>
									<tr style="height: 25px">
										<td>单位ERP编号：</td>
										<td>
											<input type="text" name="userErpUnit" readOnly="true" style="border: none;"/>
										</td>
										<td>用户ERP编号：</td>
										<td>
											<input type="text" name="userErpOrg" readOnly="true" style="border: none;"/>
										</td>
									</tr>
									<tr style="height: 25px">
										<td>所属角色：</td>
										<td colspan="3">
											<input type="text" name="userStatus" readOnly="true" style="border: none;"/>
										</td>
									</tr>
								</tbody>
							</table>
						</form>
					</div>
					<div style="width:100%; text-align: center;margin-top: 10px;">
						<a href="#" class="easyui-linkbutton" onclick="$('#dlg1').window('close')">关闭</a>
					</div>
				</div>
				<div id='dlg2' class="easyui-window" closed='true' title="提示信息" data-options="modal:true,collapsible:false,minimizable:false,maximizable:false,iconCls:'icon-save'" style="width:300px;height:170px;">
					<div style="padding: 10px; box-sizing: border-box;">
						<table border="0">
							<tr>
								<td>
									<div class="messager-icon messager-question"></div>
								</td>
								<td>您确认初始化【张法】的密码吗？</td>
							</tr>
						</table>
					</div>
					<div style="width:100%; text-align: center;margin-top: 10px;">
						<a href="#" class="easyui-linkbutton" onclick="$('#dlg2').window('close')">确定</a>
						<a href="#" class="easyui-linkbutton" onclick="$('#dlg2').window('close')">关闭</a>
					</div>
				</div>

			</div>
		</div>

	</body>

	<script type="text/javascript">
		$(function() {
			$('#dg').datagrid({
				singleSelect: false,
				collapsible: true,
				rownumbers: true,
				pagination: true,
				url: 'http://dayan.huayitec.com/userController/getListPage',
				columns: [
					[{
							field: 'checkbox',
							checkbox:true
						},{
							field: 'userNameRel',
							title: '用户登录名',
							width: 130,
							align: 'center',
							sortable: true
						},
						{
							field: 'userName',
							title: '用户姓名',
							width: 130,
							align: 'center',
							sortable: true
						},
						{
							field: 'userEmail',
							title: '邮箱',
							width: 200,
							align: 'center',
							sortable: true
						},
						{
							field: 'userPhone',
							title: '手机号',
							width: 130,
							align: 'center',
							sortable: true
						},
						{
							field: 'userTel',
							title: '座机号',
							width: 130,
							align: 'center',
							sortable: true
						},
						{
							field: 'userUnitName',
							title: '单位名称',
							width: 210,
							align: 'center',
							sortable: true
						},
						{
							field: 'positionName',
							title: '职务',
							width: 150,
							align: 'center',
							sortable: true
						},
						{
							field: 'userLastTime',
							title: '最后登录时间',
							width: 200,
							align: 'center',
							sortable: true
						},
						{
							field: 'userStatus',
							title: '用户状态',
							width: 100,
							align: 'center',
							sortable: true
						},
						{
							field: 'rolename',
							title: '权限',
							width: 240,
							align: 'center',
							sortable: true
						},
						{
							field: 'id',
							title: '操作',
							width: 260,
							align: 'center',
							formatter: function(value, row, index) {						
									var e = "<a href='#' onclick=editrow("+index+")  style='color: dodgerblue;margin-right:5px'>修改</a>";
									var d = "<a href='#' onclick=deleterow("+index+") style='color: dodgerblue;margin-right:5px'>删除</a>";
									var x = "<a href='#' onclick=saverow("+index+")  style='color: dodgerblue;margin-right:5px'>详情</a>";
									var p = '<a href="#" onclick="cancelrow(this)"  style="color: dodgerblue;">初始化密码</a>';
									return e + d + x + p;
							}
						}
					]
				]
			});
		});
		
	//修改弹框
	    var url;
		function editrow(index) {
			$('#dlg').window('open');
		    var a = $('#dg').datagrid('selectRow',index);  
            var row = $('#dg').datagrid('getSelected'); 
            console.log(row)
             $("#update").form("load", row);
             url = "http://dayan.huayitec.com/userController/update?id="+row.id      
		}
	//提交修改数据		
        function modify(){
			$("#update").form({
                url: url,
                success: function(data) {
					$('#dlg').window('close')
					$('#dg').datagrid('reload');
				}
              })
       }
// 详情
	function saverow(index) {
		$('#dlg1').window('open');
        var a = $('#dg').datagrid('selectRow',index);  
        var row = $('#dg').datagrid('getSelected'); 
        console.log(row)
        $("#message").form("load", row);
        var url = "http://dayan.huayitec.com/userController/update?id="+row.id 
	}
//   查询		
		function query() {
			$("#dg").datagrid("load", sy.serializeObject($("#searchForm").form())); //将searchForm表单内的元素序列为对象传递到后台
		}
//添加
		function search() {
			$('#ff').form({
			url: 'http://dayan.huayitec.com/userController/insert',
				success: function(data) {
					$('#dlg0').window('close')
					$('#dg').datagrid('reload');
				}
			});
		}

//初始化密码
	function getRowIndex(target) {
			var tr = $(target).closest('tr.datagrid-row');
			return parseInt(tr.attr('datagrid-row-index'));
		}
		function cancelrow(target) {
			$('#dg').datagrid('cancelEdit', getRowIndex(target));
			$('#dlg2').window('open');
		}
//删除
        function deleterow(index) {
            var a = $('#dg').datagrid('selectRow',index);  
            var row = $('#dg').datagrid('getSelected'); 
            if (row) {
            	$.extend($.messager.defaults,{
                ok:"确定",
                cancel:"取消"
            });
            $.messager.confirm('提示信息','删除用户将导致该用户无法进入系统，是否删除?',function(r){   
                if (r){   
                    $.ajax({
							method: 'GET',
							contentType: "application/json",
							url: 'http://dayan.huayitec.com/userController/delete?id='+row.id,
							success: function(data) {
                                  deleteRows('#dg')  //前端删除数据
                                  $('#dg').datagrid('reload');
							},
							error: function() {
								alert('error');
							}
						});  
                }   
            });
//              $.messager.confirm('提示信息', '删除用户将导致该用户无法进入系统，是否删除?', function (r) {
//                  if (r) {
//                  	console.log(r)
//                     $.ajax({
//							method: 'GET',
//							contentType: "application/json",
//							url: 'http://dayan.huayitec.com/userController/delete?id='+row.id,
//							success: function(data) {
//                                deleteRows('#dg')  //前端删除数据
//                                $('#dg').datagrid('reload');
//							},
//							error: function() {
//								alert('error');
//							}
//						});
//                  }
//              });
            }
        } 
	</script>

</html>